@using Sandbox;
@using System;
@using System.Collections.Generic;

@namespace Murder.UI

@if (Game.LocalPawn is not Murder.Player localPlayer)
{
	return;
}

<root class="@(Input.Down(InputButton.Score) ? "show" : "")">
	<div class="container rounded background-color-primary">
		<ScoreboardInfo />
		<div class="groups">
			@* Whatever, it's murder... *@
			@{
				var players = Utils.GetPlayersWhere(p => !p.IsForcedSpectator);
				var spectators = Utils.GetPlayersWhere(p => p.IsForcedSpectator);
				var isGroupCreated = new List<bool>(){ false, false };

				@foreach (var player in players)
				{
					if (!isGroupCreated[0]) {
						<ScoreboardGroup Name="Players" />
						isGroupCreated[0] = true;
					}

					<ScoreboardEntry Client=@player.Client />
				}

				@foreach (var spectator in spectators)
				{
					if (!isGroupCreated[1]) {
						<ScoreboardGroup Name="Spectators" />
						isGroupCreated[1] = true;
					}

					<ScoreboardEntry Client=@spectator.Client />
				}
			}
		</div>
	</div>
	<div style="width: 45%;">
		<button class="spectate-button text-shadow" @onclick=@Murder.Player.ToggleForceSpectator icon=@(localPlayer.IsForcedSpectator ? "videocam_off" : "videocam")>
			@(localPlayer.IsForcedSpectator ? "Disable Forced Spectating" : "Enable Forced Spectating")
		</button>
	</div>
</root>

@code
{
	protected override int BuildHash()
	{
		return HashCode.Combine(
			Input.Down(InputButton.Score), 
			(Game.LocalPawn as Murder.Player)?.IsForcedSpectator,
			Game.Clients.HashCombine(client => HashCode.Combine(client.SteamId, (client.Pawn as Murder.Player)?.IsForcedSpectator))
		);
	}
}

<style>
	Scoreboard 
	{
		pointer-events: all;
		width: 100%;
		height: 100%;
        opacity: 0;
        z-index: 1;
		justify-content: center;
		align-items: center;
		flex-direction: column;

		&.show {
            opacity: 0.98;
        }

		.container 
		{
			flex-direction: column;
			max-height: 70%;
			width: 45%;
			backdrop-filter-blur: 20px;

			.groups 
			{
				flex-direction: column;
				padding: 8 8 12 8;
				overflow: scroll;
			}
		}

		.spectate-button
		{
			align-items: center;
			margin: 2px 5px;
			transition: all 0.1s ease;

			label
			{
				font-size: 16px;
			}

			iconpanel
			{
				font-size: 20px;
				margin-right: 3px;
			}

			&:hover
			{
				color: #dfdfdf;
				cursor: pointer;
				transform: scale(1.01);
			}

			&:active
			{
				color: #c4c4c4;
				transform: scale(1);
			}
		}
	}
</style>